<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <script type="text/javascript" src="https://latest.cactus.chat/cactus.js"></script>
  <link rel="stylesheet" href="https://latest.cactus.chat/style.css" type="text/css">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> For Pentesters | Samma.io</title>
  <link rel = 'canonical' href = 'https://samma.io/posts/2021-09-21-for-pentesters/'>
  <meta name="description" content="Samma is a set och opensource scanners set toghter to keep you system secure.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="For Pentesters" />
<meta property="og:description" content="How I use the samma scanners to do recon when pentesting I was tasked to do a first pentest against an AWS-hosted environment. This was an automated test to run before a more advanced pentest was planned. And the goal was to do a quick scan of the assets to catch any low-fruits targets and then be able to resolve them before the larger pentest was conducted.
The setup To use as a base for the scanners a deployed a minikube Kubernetes on my local desktop." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://samma.io/posts/2021-09-21-for-pentesters/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-21T09:00:00+00:00" />
<meta property="article:modified_time" content="2021-09-21T09:00:00+00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="For Pentesters"/>
<meta name="twitter:description" content="How I use the samma scanners to do recon when pentesting I was tasked to do a first pentest against an AWS-hosted environment. This was an automated test to run before a more advanced pentest was planned. And the goal was to do a quick scan of the assets to catch any low-fruits targets and then be able to resolve them before the larger pentest was conducted.
The setup To use as a base for the scanners a deployed a minikube Kubernetes on my local desktop."/>

  
  
    
  
  
  <link rel="stylesheet" href="https://samma.io/css/styles.56a104c35e8692dad52597e01c30f782c8612bf9ce3b1d4572c71eff0049b8edd71457436be28a9a537080647849a63f529ea68b0316bb562b9fdd9641492b3c.css" integrity="sha512-VqEEw16GktrVJZfgHDD3gshhK/nOOx1Fcsce/wBJuO3XFFdDa&#43;KKmlNwgGR4SaY/Up6miwMWu1Yrn92WQUkrPA=="> 

  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://samma.io/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/scanners">Scanners</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/support">Support</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://samma.io/posts/2021-07-11-find-secrity-problems-early/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://samma.io/posts/2021-11-30-devs-scan-your-app/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&text=For%20Pentesters" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&title=For%20Pentesters" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&is_video=false&description=For%20Pentesters" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=For%20Pentesters&body=Check out this article: https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&title=For%20Pentesters" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&title=For%20Pentesters" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&name=For%20Pentesters&description=How%20I%20use%20the%20samma%20scanners%20to%20do%20recon%20when%20pentesting%20I%20was%20tasked%20to%20do%20a%20first%20pentest%20against%20an%20AWS-hosted%20environment.%20This%20was%20an%20automated%20test%20to%20run%20before%20a%20more%20advanced%20pentest%20was%20planned.%20And%20the%20goal%20was%20to%20do%20a%20quick%20scan%20of%20the%20assets%20to%20catch%20any%20low-fruits%20targets%20and%20then%20be%20able%20to%20resolve%20them%20before%20the%20larger%20pentest%20was%20conducted.%0aThe%20setup%20To%20use%20as%20a%20base%20for%20the%20scanners%20a%20deployed%20a%20minikube%20Kubernetes%20on%20my%20local%20desktop." aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&t=For%20Pentesters" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#the-setup">The setup</a></li>
    <li><a href="#the-scanners">The scanners</a>
      <ul>
        <li><a href="#base-scanner">Base scanner</a></li>
        <li><a href="#nmap-nikto-and-tsunami">Nmap Nikto and Tsunami</a></li>
      </ul>
    </li>
    <li><a href="#the-findings">The findings!</a></li>
    <li><a href="#moving-on">Moving on</a></li>
    <li><a href="#learnings">Learnings</a></li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        For Pentesters
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2021-09-21 09:00:00 &#43;0000 UTC" itemprop="datePublished">2021-09-21</time>
          
        </div>
        
        
        
        <div class="article-category">
            <i class="fas fa-archive"></i>
            
            
            <a class="category-link" href="/categories/on-prem">on-prem</a>
            
             ,  
            <a class="category-link" href="/categories/k8s">k8s</a>
            
             ,  
            <a class="category-link" href="/categories/minikube">minikube</a>
            
        </div>
        
        
        <div class="article-tag">
            <i class="fas fa-tag"></i>
            
            
            <a class="tag-link" href="/tags/pentester" rel="tag">Pentester</a>
            
             ,  
            <a class="tag-link" href="/tags/devsecops" rel="tag">DevSecOps</a>
            
             ,  
            <a class="tag-link" href="/tags/scanner" rel="tag">Scanner</a>
            
        </div>
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <h1 id="how-i-use-the-samma-scanners-to-do-recon-when-pentesting">How I use the samma scanners to do recon when pentesting</h1>
<p>I was tasked to do a first pentest against an AWS-hosted environment. This was an automated test to run before a more advanced pentest was planned.
And the goal was to do a quick scan of the assets to catch any low-fruits targets and then be able to resolve them before the larger pentest was conducted.</p>
<h2 id="the-setup">The setup</h2>
<p>To use as a base for the scanners a deployed a minikube Kubernetes on my local desktop. This so I could easily deploy targets and get a good overview of the result by using gafana and kibana.</p>
<p>To deploy the scanners I first test one scan with docker to verify the result then deployed the scanner as cronjob weekly into the minikube cluster.</p>
<h2 id="the-scanners">The scanners</h2>
<h3 id="base-scanner">Base scanner</h3>
<p>The first scanner I deployed was the base scanner from the samma repo. The base scanner takes a domain and does a full recon on that domain with the tool</p>
<pre tabindex="0"><code>docker run -e TARGET=example.com sammascanner/base
</code></pre><p>This will give a good overview of the domain what mail servers are used and what DNS provider DNS server.
It will also try to find more DNS servers by dictionary testing on the DNS</p>
<h3 id="nmap-nikto-and-tsunami">Nmap Nikto and Tsunami</h3>
<p>The old network scanner NMAP was used as well. The client&rsquo;s full infrastructure where hosted din AWS and by extracting all the IP from the consul I had a full list of IP.
And by setting up bash to that deployed scanners to all those IP I soon had a full list of host and open ports.</p>
<p>I then also added a nikto web scanner to run against the same host and tsunami scanner.</p>
<p>This opens the scans to go more into finding services behind the ports but also more aggressively test the targets for vulnerabilities.</p>
<pre tabindex="0"><code>input=&quot;../targets/ip.txt&quot;
while IFS= read -r line
do
  TARGET=$line
  NAME=$line
  HOURE=$(shuf -i 7-10 -n 1)
  MINUTE=$(shuf -i 0-60 -n 1)

  #helm uninstall tsunami-ip-$NAME -n samma-io
  #helm upgrade --install tsunamo-ip-$NAME  --debug --set ip=$TARGET  /home/mahe/helm-repo/tsunami -n samma-io
  #helm uninstall $NAME -n samma-io
  #helm upgrade --install $NAME  --debug --set target=$TARGET --set schedule=&quot;$MINUTE $HOURE * * 5&quot; --set image.tag=v0.2 /home/mahe/helm-repo/nmap -n samma-io
  #helm uninstall nikto-$NAME -n samma-io 
  #helm upgrade --install nikto-$NAME  --debug --set target=$TARGET --set schedule=&quot;$MINUTE $HOURE * * 5&quot; /home/mahe/helm-repo/nikto  -n samma-io
done &lt; &quot;$input&quot;


</code></pre><h2 id="the-findings">The findings!</h2>
<p>From grafana, I had a dashboard showing all the ports that were open at first I had the regular ones port 80 and 443 and some 22. I skipped the web ports 80 and 443 and start looking at the ssh. Were they open and accepted a password?
After some test, I quickly find out the ssh where all looked with key bases out.
Then a new port comes up 3306 &hellip; Well, that&rsquo;s a SQL server that is wide open and it should not be.</p>
<p>But from grafana, I could only see that the scanners had registered port 3306 was open. So I jumped into kibana and searched for &ldquo;3306&rdquo; and that quickly showed me the log record with the open port and the IP of the target.</p>
<p>To verify that the target was open a run the Nmap scanner in docker against the target and true the port was open.
Over slack, I could send a message to the network team that quickly closed the port, and then to verify I run the Nmap docker again, and now the port did not come back as open.</p>
<p>During the scan, the samma scanners also picked up bad TLS settings and other smaller findings like service versions of Nginx and ssh that were outdated.</p>
<h2 id="moving-on">Moving on</h2>
<p>To keep the system secure going forward and quickly detect if a new port comes up, or if an Nginx version is falling behind the team I set up samma scanners in their k8s cluster and set up weekly scans.
Then adding alerts on open ports and if a new port that is not 80,443 ore ssh id detected a message goes into slack.
There are also alerts on the number of Nginx hosts, Nginx versions are all the same, and so on. This keeps a good baseline for the company to work from</p>
<h2 id="learnings">Learnings</h2>
<p>It was super easy to add scanners to all the targets with my script. But the first version of the script I did not random when the crontab and this ALLA scanners would start at once bringing my desktop down in flames.
But after I had spread out the scanners over time it works much better and when you have the first weeks of scans run it&rsquo;s simple to add markers in grafana to add you when something changes.</p>
<p>To use an Operator instead of the script a wrote will also be a better and easy way to deploy a scanner. So after this, I started working on building an operator for samma.</p>
<p>Extract all the IP from AWS. That is on the to-do list here.</p>
<p>Digging at the results in kibana is kind of interesting and fun when you find the targets you are looking for.</p>

    </div>
  </article>

  
  






  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/scanners">Scanners</a></li>
         
          <li><a href="/posts">Posts</a></li>
         
          <li><a href="/support">Support</a></li>
         
          <li><a href="/about">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#the-setup">The setup</a></li>
    <li><a href="#the-scanners">The scanners</a>
      <ul>
        <li><a href="#base-scanner">Base scanner</a></li>
        <li><a href="#nmap-nikto-and-tsunami">Nmap Nikto and Tsunami</a></li>
      </ul>
    </li>
    <li><a href="#the-findings">The findings!</a></li>
    <li><a href="#moving-on">Moving on</a></li>
    <li><a href="#learnings">Learnings</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&text=For%20Pentesters" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&title=For%20Pentesters" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&is_video=false&description=For%20Pentesters" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=For%20Pentesters&body=Check out this article: https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&title=For%20Pentesters" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&title=For%20Pentesters" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&name=For%20Pentesters&description=How%20I%20use%20the%20samma%20scanners%20to%20do%20recon%20when%20pentesting%20I%20was%20tasked%20to%20do%20a%20first%20pentest%20against%20an%20AWS-hosted%20environment.%20This%20was%20an%20automated%20test%20to%20run%20before%20a%20more%20advanced%20pentest%20was%20planned.%20And%20the%20goal%20was%20to%20do%20a%20quick%20scan%20of%20the%20assets%20to%20catch%20any%20low-fruits%20targets%20and%20then%20be%20able%20to%20resolve%20them%20before%20the%20larger%20pentest%20was%20conducted.%0aThe%20setup%20To%20use%20as%20a%20base%20for%20the%20scanners%20a%20deployed%20a%20minikube%20Kubernetes%20on%20my%20local%20desktop." aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fsamma.io%2fposts%2f2021-09-21-for-pentesters%2f&t=For%20Pentesters" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  Samma.io 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/scanners">Scanners</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/support">Support</a></li>
         
        <li><a href="/about">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>

<script src=/js/code-copy.js></script>




</html>
